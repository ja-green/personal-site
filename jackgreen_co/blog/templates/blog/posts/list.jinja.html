{# Copyright (C) 2024 Jack Green (jackgreen.co)

   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program. If not, see <https://www.gnu.org/licenses/>. #}

{% extends "layouts/two-column/right-sidebar.jinja.html" %}

{% from "components/header.jinja.html" import header, header_title %}
{% from "components/card.jinja.html" import card, card_body, card_aside, card_header, card_title, card_content %}
{% from "components/pagination.jinja.html" import pagination, pagination_previous, pagination_next, pagination_more, pagination_page %}

{% block navbar %}
{% include 'main/partials/navbar.jinja.html' %}
{% endblock navbar %}

{% block header %}
{% call header() %}
    {{ header_title(messages["blog_posts_heading"], subtitle=messages["blog_posts_subheading"]) }}
{% endcall %}
{% endblock header %}

{% block content %}
{% for post in posts %}
    {% call card(class_="mb-6") %}
        {% call card_aside() %}
            <a href="{{ url_for("blog.post", slug=post.slug) }}">
                <img src="https://via.placeholder.com/200" class="object-cover h-full rounded-l-lg" />
            </a>
        {% endcall %}
        {% call card_body() %}
            {% call card_header() %}
                {% call card_title(post.title) %}
                    <time datetime="{{ post.date.strftime("%Y-%m-%d") }}" class="mr-1">
                        {{ post.date.strftime("%B %-d, %Y") }}
                    </time>
                    &middot;
                    <span class="ml-1">
                        {{ post.read_time }} minute read
                    </span>
                {% endcall %}
            {% endcall %}
            {% call card_content() %}
                <p>{{ post.preview }}</p>
            {% endcall %}
        {% endcall %}
    {% endcall %}
{% endfor %}

{% call pagination() %}
    {% if page == 1 %}
        {{ pagination_previous(href=url_for("blog.posts", page=page), disabled=true) }}
    {% else %}
        {{ pagination_previous(href=url_for("blog.posts", page=page-1)) }}
    {% endif %}

    {{ pagination_page(1, href=url_for("blog.posts", page=1), current=(page==1)) }}
    {% if page > 4 %}
        {{ pagination_more() }}
    {% endif %}

    {% set start_page = [page - 3, 2] | max %}
    {% set end_page = [page + 3, total_pages - 1] | min %}

    {% for i in range(start_page, end_page + 1) %}
        {% if page == i or page - 1 == i or page + 1 == i %}
            {{ pagination_page(text=i, href=url_for("blog.posts", page=i), current=(page==i)) }}
        {% else %}
            {{ pagination_page(i, href=url_for("blog.posts", page=i), class_="hidden sm:inline-flex") }}
        {% endif %}
    {% endfor %}

    {% if page < total_pages - 3 %}
        {{ pagination_more() }}
    {% endif %}

    {% if total_pages > 1 %}
        {{ pagination_page(total_pages, href=url_for("blog.posts", page=total_pages), current=(page==total_pages)) }}
    {% endif %}

    {% if page == total_pages %}
        {{ pagination_next(href=url_for("blog.posts", page=page), disabled=true) }}
    {% else %}
        {{ pagination_next(href=url_for("blog.posts", page=page+1)) }}
    {% endif %}
{% endcall %}
{% endblock content %}

{% block sidebar %}
{% endblock sidebar %}

{% block footer %}
{% include 'main/partials/footer.jinja.html' %}
{% endblock footer %}

{# vim: set ft=htmldjango: #}
